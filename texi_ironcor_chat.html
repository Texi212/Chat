<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Einfacher Chat</title>
  <style>
    body{margin:0;font-family:Arial;background:#0f1724;color:#e6eef8;display:flex;justify-content:center;align-items:center;height:100vh}
    .app{width:100%;max-width:900px;height:90vh;background:#0b1320;border-radius:12px;overflow:hidden;display:grid;grid-template-columns:260px 1fr}
    .sidebar{padding:20px;background:#0d1526}
    .text-input{width:100%;padding:10px;border-radius:8px;border:1px solid #334; background:#112;color:#eee}
    .btn{margin-top:10px;padding:10px;width:100%;border-radius:8px;border:1px solid #334;background:#112;color:#eee;cursor:pointer}
    .status{margin-top:10px;color:#889}
    .main{display:flex;flex-direction:column;height:100%}
    .topbar{padding:15px;border-bottom:1px solid #223;font-weight:bold}
    .chat-window{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px}
    .msg{max-width:70%;padding:10px;border-radius:10px;background:#112;border:1px solid #223}
    .you{margin-left:auto;background:#1b2f4a;border-color:#345}
    .composer{padding:10px;border-top:1px solid #223;display:flex;gap:10px}
    .file-preview{display:flex;gap:8px;flex-wrap:wrap;margin-top:5px}
    .thumb{width:120px;background:#071428;padding:6px;border-radius:6px}
    .thumb img,.thumb video{width:100%;height:80px;object-fit:cover;border-radius:6px}
  </style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <h2>Login</h2>
    <input id="nickname" class="text-input" placeholder="Dein Name" />
    <button class="btn" id="loginBtn">Einloggen</button>
    <button class="btn" id="clearBtn">Chat lÃ¶schen</button>
    <p class="status" id="status">Nicht eingeloggt</p>
  </aside>

  <main class="main">
    <div class="topbar" id="userLabel">Bitte anmeldenâ€¦</div>
    <div class="chat-window" id="chatWindow"></div>

    <div class="composer">
      <input id="textMsg" class="text-input" placeholder="Nachricht schreiben..." />
      <label class="btn">ðŸ“Ž<input id="fileInput" type="file" accept="image/*,video/*" multiple style="display:none"></label>
      <button class="btn" id="sendBtn">Senden</button>
    </div>
  </main>
</div>

<script>
let currentUser = null;
let messages = JSON.parse(localStorage.getItem('simple_chat') || '[]');

const chatWindow = document.getElementById('chatWindow');

function save(){ localStorage.setItem('simple_chat', JSON.stringify(messages)); }

function render(){
  chatWindow.innerHTML = '';
  messages.forEach(m=>{
    const box = document.createElement('div');
    box.className = 'msg' + (currentUser && m.from === currentUser ? ' you' : '');
    if(m.text) box.append(m.text);
    if(m.files){
      const fp = document.createElement('div'); fp.className='file-preview';
      m.files.forEach(f=>{
        const t = document.createElement('div'); t.className='thumb';
        if(f.type.startsWith('image/')){ let img=document.createElement('img'); img.src=f.data; t.append(img); }
        else if(f.type.startsWith('video/')){ let v=document.createElement('video'); v.src=f.data; v.controls=true; t.append(v); }
        fp.append(t);
      });
      box.append(fp);
    }
    chatWindow.append(box);
  });
  chatWindow.scrollTop = chatWindow.scrollHeight;
}
render();

document.getElementById('loginBtn').onclick = ()=>{
  const name = document.getElementById('nickname').value.trim();
  if(!name) return alert('Bitte Name eingeben.');
  currentUser = name;
  document.getElementById('status').innerText = 'Eingeloggt als ' + name;
  document.getElementById('userLabel').innerText = name;
};

document.getElementById('clearBtn').onclick = ()=>{
  if(confirm('Alles lÃ¶schen?')){ messages=[]; save(); render(); }
};

function readFiles(list){ return Promise.all([...list].map(f=>new Promise(res=>{let r=new FileReader(); r.onload=()=>res({name:f.name,type:f.type,data:r.result}); r.readAsDataURL(f);}))); }

document.getElementById('sendBtn').onclick = async()=>{
  if(!currentUser) return alert('Bitte einloggen.');
  const text = document.getElementById('textMsg').value.trim();
  const files = document.getElementById('fileInput').files;
  if(!text && files.length===0) return;
  let data=[];
  if(files.length) data = await readFiles(files);
  messages.push({from:currentUser,text,files:data});
  save();
  document.getElementById('textMsg').value='';
  document.getElementById('fileInput').value='';
  render();
};
</script>
</body>
</html>
